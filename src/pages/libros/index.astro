---
import BaseLayout from '@layouts/BaseLayout.astro';
import CatalogFilter from '@islands/CatalogFilter.svelte';
import { supabase } from '@lib/supabase';

// 1. Fetch de Datos (Server-Side)
// Traemos TODOS los productos activos.
// No te preocupes por el peso: 500 libros en JSON son apenas ~100KB gzippeados.
const { data: products, error } = await supabase
  .from('products')
  .select('id, title, author, price, promotional_price, slug, cover_image, category_id, language, created_at')
  .eq('status', 'active')
  .order('created_at', { ascending: false });

const { data: categories } = await supabase
  .from('categories')
  .select('id, name')
  .order('name');

if (error) {
  console.error("Error cargando catálogo:", error);
}

// SEO
const title = "Catálogo Completo | Librería High-Performance";
const description = "Explora nuestra colección completa de libros. Filtra por autor, precio y categoría.";
---

<BaseLayout title={title} description={description}>
  
  <div class="bg-paper-surface min-h-screen">
    
    <header class="bg-brand-ink text-white py-10 px-6 mb-8 shadow-sm">
        <div class="container mx-auto max-w-6xl">
            <h1 class="font-serif font-bold text-3xl md:text-4xl mb-2 text-paper-base">Biblioteca Completa</h1>
            <p class="text-white/60 max-w-6xl">
                Navega a través de nuestra colección curada. Utiliza los filtros para encontrar tu próxima lectura ideal.
            </p>
        </div>
    </header>

    <div class="container mx-auto max-w-400 px-6 pb-20">
      
      {products && (
        <CatalogFilter 
          client:load 
          products={products} 
          categories={categories || []} 
        />
      )}

      {!products && (
        <div class="text-center py-12 text-red-500">
            Error al conectar con la base de datos. Por favor recarga.
        </div>
      )}

    </div>

  </div>
</BaseLayout>
